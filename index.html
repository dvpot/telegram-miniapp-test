<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Telegram Mini App ‚Äî English Words</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root {
      --bg: #eef2f5;
      --card: #ffffff;
      --accent: #0088cc;
      --accent-dark: #006fa6;
      --muted: #6b7280;
      --radius: 14px;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: var(--bg);
    }

    .app {
      max-width: 600px;
      margin: 0 auto;
      height: 100vh;
      padding: 12px;
      box-sizing: border-box;
      display: flex;
    }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: 0 8px 22px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      gap: 18px;
      flex: 1;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .username {
      font-size: 22px;
      font-weight: 700;
    }

    .image-area {
      width: 100%;
      min-height: 180px;
      background: #e9ecef;
      border-radius: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    .image-area img {
      width: 100%;
      height: auto;
      object-fit: cover;
    }

    .image-placeholder {
      color: var(--muted);
      font-size: 14px;
    }

    /* –ü–æ–ª–µ —Å–ª–æ–≤–æ + —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è */
    .field {
      background: #fafafa;
      border: 1px solid #d0d0d0;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      cursor: pointer;
      transition: 0.3s;
      position: relative;
    }

    .field:hover {
      background: #f0f0f0;
    }

    .word-text {
      font-size: 26px;
      font-weight: 700;
      margin: 0;
      opacity: 0;
      transition: opacity .3s;
    }

    .trans-text {
      font-size: 18px;
      color: var(--muted);
      margin: 8px 0 0 0;
      opacity: 0;
      transition: opacity .3s;
    }

    .visible { opacity: 1 !important; }

    /* –ü–µ—Ä–µ–≤–æ–¥ */
    .translation-field {
      background: #fafafa;
      padding: 18px;
      border-radius: 12px;
      text-align: center;
      font-size: 26px;
      font-weight: 700;
    }

    /* –ö–Ω–æ–ø–∫–∏ –æ–∑–≤—É—á–∫–∏ */
    .tts-row {
      display: flex;
      justify-content: center;
      gap: 12px;
    }

    .tts-btn {
      padding: 10px 16px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 30px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.2s;
    }

    .tts-btn:hover {
      background: var(--accent-dark);
    }

    /* –ö–Ω–æ–ø–∫–∞ –Ω–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞ */
    .btn {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      background: var(--accent);
      color: white;
      font-size: 20px;
      font-weight: 700;
      border: none;
      cursor: pointer;
      transition: .2s;
    }

    .btn:hover {
      background: var(--accent-dark);
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="card">

      <div class="header">
        <div id="username" class="username">–ü—Ä–∏–≤–µ—Ç!</div>
      </div>

      <div id="imageArea" class="image-area">
        <div id="imagePlaceholder" class="image-placeholder">–ö–∞—Ä—Ç–∏–Ω–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</div>
      </div>

      <!-- –ö–ù–û–ü–ö–ò –û–ó–í–£–ß–ö–ò -->
      <div class="tts-row">
        <button class="tts-btn" id="speakEN">üîä EN</button>
        <button class="tts-btn" id="speakRU">üîä RU</button>
      </div>

      <div class="field" id="wordField">
        <p id="wordText" class="word-text">---</p>
        <p id="transText" class="trans-text">---</p>
      </div>

      <div class="translation-field">
        <p id="translationText">---</p>
      </div>

      <button id="nextBtn" class="btn">–°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ</button>
    </div>
  </div>

<script>
/* –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM */
const tg = window.Telegram?.WebApp;
if (tg) tg.ready();

const usernameEl = document.getElementById('username');
const user = tg?.initDataUnsafe?.user;
if (user) {
    usernameEl.textContent = `–ü—Ä–∏–≤–µ—Ç, ${user.first_name || user.username}!`;
}

/* –≠–õ–ï–ú–ï–ù–¢–´ */
const imageArea = document.getElementById('imageArea');
const imagePlaceholder = document.getElementById('imagePlaceholder');
const wordField = document.getElementById('wordField');
const wordText = document.getElementById('wordText');
const transText = document.getElementById('transText');
const translationText = document.getElementById('translationText');
const btnEN = document.getElementById('speakEN');
const btnRU = document.getElementById('speakRU');
const nextBtn = document.getElementById('nextBtn');

let words = [];
let current = null;
let revealed = false;

/* SPEECH API */
function speak(text, lang) {
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = lang;
    speechSynthesis.speak(utter);
}

/* –ö–ê–†–¢–ò–ù–ö–ê */
function setImage(src) {
    imageArea.innerHTML = "";
    if (!src) {
        imageArea.innerHTML = '<div class="image-placeholder">–ö–∞—Ä—Ç–∏–Ω–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</div>';
        return;
    }
    const img = document.createElement('img');
    img.src = src;
    img.onerror = () => {
        imageArea.innerHTML = '<div class="image-placeholder">–ö–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</div>';
    };
    imageArea.appendChild(img);
}

/* –ó–ê–ì–†–£–ó–ö–ê –°–õ–û–í */
async function loadWords() {
    const r = await fetch("words.json", {cache: "no-store"});
    words = await r.json();
}

/* –ü–û–ö–ê–ó–ê–¢–¨ –°–õ–£–ß–ê–ô–ù–û–ï */
function loadRandomWord() {
    if (!words.length) return;

    const idx = Math.floor(Math.random() * words.length);
    current = words[idx];
    revealed = false;

    wordText.textContent = current.word;
    transText.textContent = `[${current.transcription}]`;
    translationText.textContent = current.translation;

    setImage(current.image);

    // —Å–∫—Ä—ã—Ç—å —Ç–µ–∫—Å—Ç
    wordText.classList.remove("visible");
    transText.classList.remove("visible");
}

/* –ü–û–ö–ê–ó –°–õ–û–í–ê –ü–û –ö–õ–ò–ö–£ */
wordField.addEventListener("click", () => {
    if (!revealed) {
        wordText.classList.add("visible");
        transText.classList.add("visible");
        revealed = true;
    }
});

/* –ö–ù–û–ü–ö–ò –û–ó–í–£–ß–ö–ò */
btnEN.onclick = () => speak(current.word, "en-US");
btnRU.onclick = () => speak(current.translation, "ru-RU");

/* –ö–ù–û–ü–ö–ê –°–õ–ï–î–£–Æ–©–ï–ì–û */
nextBtn.onclick = loadRandomWord;

/* –°–¢–ê–†–¢ */
(async () => {
    await loadWords();
    loadRandomWord();
})();
</script>
</body>
</html>
